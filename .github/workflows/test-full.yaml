name: full CI
run-name: ${{ github.actor }} run Actions ðŸš€

on:
  workflow_dispatch:
    inputs:
      run-docker:
        description: 'Run Docker Build and Push'
        required: false
        default: true
        type: boolean
      run-argocd:
        description: 'Run ArgoCD Deployment'
        required: false
        default: true
        type: boolean
      debug:
        description: 'Enable debug mode'
        required: false
        default: true
        type: boolean

jobs:
  docker:
    if: ${{ github.event.inputs.run-docker }}
    uses: mequq/.ci_template/.github/workflows/docker.yaml
    with:
      debug: true
      registry: ${{ vars.REGISTERY_ADDRESS }}
    secrets:
      REGISTERY_USER: ${{ secrets.REGISTERY_USER }}
      REGISTERY_PASSWORD: ${{ secrets.REGISTERY_PASSWORD }}
  argocd:
    if: ${{ github.event.inputs.run-argocd }}
    uses: mequq/.ci_template/.github/workflows/argocd.yaml
    needs: docker
    with:
      debug: true
      registry: ${{ vars.REGISTERY_ADDRESS }}
    secrets:
      ARGOCD_GIT_TOKEN: ${{ secrets.ARGOCD_GIT_TOKEN }}
  